#!/bin/bash

LOGFILE="coverage_diagnostic_$(date +%Y%m%d_%H%M%S).log"

echo "=== Erasing previous coverage data ===" | tee $LOGFILE
coverage erase 2>&1 | tee -a $LOGFILE

echo "=== Running tests with coverage on 'bin' folder ===" | tee -a $LOGFILE
coverage run --source=bin -m pytest -vv tests/test_bin/ 2>&1 | tee -a $LOGFILE

echo "=== Generating coverage report ===" | tee -a $LOGFILE
coverage report -m 2>&1 | tee -a $LOGFILE

echo "Diagnostic complete. Output saved to $LOGFILE"
